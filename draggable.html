<!doctype html>
 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>jQuery UI Droppable - Revert draggable position</title>
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>

<script>
window.input = {
	id : 19,
	data: [
		["fc746971782f7042865d9ebc832fe149", "lightbulb.png"],
		["f8570db1180d30f6a890a27e662028ec", "chips.png"],
		["41f39c3a3b85b1676ac936898bf72dd1", "box.png"],
	],
	bin : 'binPaper.png',
	type : 'dnd'
};

/*
	Captcha Wrapper
*/
(function(){
	/*
		Proposition for input object format:
		input = {
			id = "khlhhhkhnk", 		// id-hash of the question
			imgPath = "romanzubenko.com/img/hkhhahksbd",    // path to distorted image
			target = "#captcha"    // container where to put captcha
		}

	*/

	function gc(target) {
		this.id = window.input.id;
		this.data = window.input.data;
		this.pointer = target;
		this.type = window.input.type;
		this.bin = window.input.bin || null;
		this.construct();
	}

	gc.prototype.construct = function() {

		var app = this;

		var	gCaptcha = $("<gcap />",{id : "gCaptcha"}).css({
				'width': '300px',
				'margin': '0 auto',
				'font-family': '"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif',
				'text-transform':'none',
				'letterSpacing': '0'
			}),
			gBody = $("<gcap />",{id : "gCaptcha-body"}).appendTo(gCaptcha).css({
				'border-top': '1px solid #cdcdcd'
			}),
			gBottom;


		$("<gcap />", {
			id : "gCaptcha-description",
			text: "Type last two word of the sentence to the input box and click submit!"
		}).appendTo(gBody).css({
			'padding': '8px',
			'font-size': '13px',
			'border-left': '3px solid rgb(34, 156, 83)',
			'border-right': '1px solid #cdcdcd',
			'min-height': '30px',
			'background': 'rgb(245, 252, 245)',
			'border-bottom': '1px solid #cdcdcd'
		});

		var	qArea = $("<gcap />",{
				id: "gCaptcha-question_area"
			}).appendTo(gBody).css({
				'min-height': '30px',
				'border-left': '1px solid #cdcdcd',
				'border-right': '1px solid #cdcdcd',
				'position': 'relative',
				'background-image': 'url(public/images/drag/bg.png)'
			});


		if (this.type === "fact") {
			$("<img />", {
				id: "gCaptcha-question"
			}).attr('src', app.imgPath).appendTo(qArea);

			$("<input/>", {
				id: "gCaptcha-input",
				type: "text"
			}).appendTo(qArea);
		}else{
			//Drag and Drop!
			var trashItems = {};

			//Classes
			$(qArea).css("height", "100");

			//Add Bin
			$("<img />", {
				src: "public/images/drag/item/"+this.bin
			}).css({
				'position': 'absolute',
				'top': '0',
				'right': '0'
			}).appendTo(qArea).droppable({
				drop: function( event, ui ){
					console.log(app.answer);
					app.answer = ui.draggable[0].hash;


					//Put back
					$(".item").each(function(e){

						if( $(this).attr("class") != $(ui.draggable).attr("class") ){
							console.log("Moving back " + $(this).attr("class"));

							//Put Added Objects Back to Initial Position
							$(this).draggable( "option", "revert", true );
						}
					});
				}
			});


			//Add Items
			var position = 0;
			$(this.data).each(function(){
				var image = $("<img />", {
					src: "public/images/drag/item/"+$(this)[1]
				}).css({
					'position': 'absolute',
					'top':'25px',
					'left': (position+10)+'px'
				}).appendTo(qArea).draggable({
					containment: qArea,
					stack: "div.bin"
				});
				position += 50;
				image[0].hash = $(this)[0];
				trashItems[image[0].hash] = image;
			});
		}
		
		gBottom = $("<gcap />", {
			id : "gCaptcha-bottom"}).appendTo(gCaptcha).css({
			'border-bottom-right-radius': '4px',
			'border-bottom-left-radius': '4px',
			'height': '30px',
			'padding': '10px',
			'border': '1px solid #cdcdcd'
		});

		$("<img />", {
			id : "gCaptcha-logo",
			src : "http://www.romanzubenko.com:3002/images/greenCaptcha-logo.png"
		}).appendTo(gBottom).css({
			'font-weight': '600',
			'width': '154px',
			'margin-top': '-11px',
			'display': 'block',
			'float': 'left'
		});

		$("<gcap />", {
			id : "gCaptcha-submit",
			text : "Submit"
		}).appendTo(gBottom).css({
			'height': '16px',
			'padding': '5px 8px 5px 8px',
			'border': '1px solid #cdcdcd',
			'border-radius': '2px',
			'text-align': 'center',
			'float': 'right',
			'display': 'inline-block',
			'cursor': 'pointer',
			'font-size': '12px',
			'background-image': '-webkit-linear-gradient(top, rgb(255, 255, 255), rgb(238, 238, 238))'
		});

		//document.styleSheets[0].insertRule('#gCaptcha-submit :hover {border-left: 3px solid rgb(30, 145, 26)}', 0);

		gCaptcha.appendTo(this.pointer);
		console.log(this.pointer)
		$("gcap").css("display", "block").css("all", "default;");
	}

	window.GreenCaptcha = gc;
})(window);
$(document).ready(function(){
	window.captcha = new GreenCaptcha("#captcha"); 
});
</script>
</head>
<body>

	<div id="captcha"></div>	




</body>
</html>